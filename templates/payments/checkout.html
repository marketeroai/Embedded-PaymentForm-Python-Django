{% extends 'base.html' %}
{% load static %}

{% block title %}Checkout - Izipay{% endblock %}

{% block extra_head %}
<!-- Bootstrap -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/journal/bootstrap.min.css"
    integrity="sha384-QDSPDoVOoSWz2ypaRUidLmLYl4RyoBWI44iA5agn6jHegBxZkNqgm2eHb6yZ5bYs" crossorigin="anonymous" />

<!-- Libreria JS de la pasarela -->
<script type="text/javascript"
    src="https://static.micuentaweb.pe/static/js/krypton-client/V4.0/stable/kr-payment-form.min.js"
    kr-public-key="{{ publickey }}"
    kr-post-url-success="{% url 'payments:success' %}",
    kr-post-url-refused="{% url 'payments:failed' %}",
    kr-language="es-Es">
</script>

<!-- Estilos de la pasarela de pagos -->
<link rel="stylesheet" href="https://static.micuentaweb.pe/static/js/krypton-client/V4.0/ext/classic.css">
<script type="text/javascript" src="https://static.micuentaweb.pe/static/js/krypton-client/V4.0/ext/classic.js"></script>
{% endblock %}

{% block content %}
<section class="container">
    <div class="row">
        <div class="col-md-3"></div>
        <div class="center-column col-md-6">
            <section class="payment-form">
                <div class="row">
                    <div class="col-12">
                        <h4 class="mb-3">Monto a pagar: S/. {{ payment.amount }}</h4>
                        <p>Pago con tarjeta de crédito/débito</p>
                        <img src="https://github.com/izipay-pe/Imagenes/blob/main/logo_tarjetas_aceptadas/logo-tarjetas-aceptadas-351x42.png?raw=true"
                             alt="Tarjetas aceptadas"
                             style="width: 200px;">
                    </div>
                </div>
                <hr>
                <div id="micuentawebstd_rest_wrapper">
                    <div class="kr-embedded" kr-form-token="{{ token }}"></div>
                </div>
                <div id="kr-error" class="alert alert-danger" style="display:none; margin-top: 1rem;"></div>
            </section>
        </div>
        <div class="col-md-3"></div>
    </div>
</section>

<script>
    setTimeout(function() {
        if (typeof KR !== 'undefined') {
            KR.onError(function(event) {
                var code = event.errorCode;
                var message = event.errorMessage;
                console.error(code + ": " + message);
                document.getElementById('kr-error').innerText = code + ": " + message;
                document.getElementById('kr-error').style.display = 'block';
            });
        } else {
            console.error("KR not defined after timeout");
            document.getElementById('kr-error').innerText = "KR is not defined";
            document.getElementById('kr-error').style.display = 'block';
        }
    }, 1000);
</script>
{% endblock %}
